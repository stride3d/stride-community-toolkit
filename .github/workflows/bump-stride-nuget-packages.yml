name: Update Stride Packages

on:
  workflow_dispatch:      # Allow manual triggering

jobs:
  update-packages:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Setup .NET
        uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'

      - name: Install dotnet-outdated tool
        run: |
          dotnet tool install --global dotnet-outdated-tool
          # Add the dotnet tools path to the PATH
          echo "$HOME/.dotnet/tools" >> $GITHUB_PATH          

      - name: Update NuGet packages
        id: update
        run: |
          # Run the update on the solution level (assumes the .sln is in the root folder)
          dotnet outdated -u
          
          # Configure Git user for commit attribution
          git config --global user.email "actions@github.com"
          git config --global user.name "GitHub Actions"
          
          # Check if any changes were made
          if ! git diff --quiet; then
            echo "updates_found=true" >> $GITHUB_OUTPUT
          else
            echo "updates_found=false" >> $GITHUB_OUTPUT
          fi

      - name: Create Pull Request
        if: steps.update.outputs.updates_found == 'true'
        uses: peter-evans/create-pull-request@v7
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "build: update NuGet packages"
          title: "Update NuGet packages"
          body: |
            This PR updates outdated NuGet packages.
            Auto-generated by the Update NuGet Packages workflow.
          branch: package-updates
          base: main
